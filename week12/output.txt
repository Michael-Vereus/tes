-- DROP TABLES IF EXISTS
DROP TABLE IF EXISTS DETAIL_TRANSAKSI;
DROP TABLE IF EXISTS TRANSAKSI;
DROP TABLE IF EXISTS BARANG;
DROP TABLE IF EXISTS CUSTOMER;
DROP TABLE IF EXISTS KATEGORI_BARANG;
DROP TABLE IF EXISTS SUPPLIER;
DROP TABLE IF EXISTS USER;

-- TABLE: SUPPLIER
CREATE TABLE SUPPLIER (
    ID_SUPPLIER     CHAR(3) PRIMARY KEY,
    NM_SUPPLIER     VARCHAR(50) NOT NULL,
    ALMT_SUPPLIER   VARCHAR(100) NOT NULL,
    TELP_SUPPLIER   CHAR(12) NOT NULL,
    STATUS          CHAR(1) NOT NULL
);

-- TABLE: KATEGORI_BARANG
CREATE TABLE KATEGORI_BARANG (
    ID_KATEGORI     CHAR(3) PRIMARY KEY,
    NM_KATEGORI     VARCHAR(50) NOT NULL
);

-- TABLE: BARANG
CREATE TABLE BARANG (
    ID_BRNG         CHAR(3) PRIMARY KEY,
    ID_SUPPLIER     CHAR(3),
    ID_KATEGORI     CHAR(3),
    NM_BRNG         VARCHAR(50) NOT NULL,
    HARGA           NUMERIC(7,0) NOT NULL,
    STOCK           NUMERIC(3,0) NOT NULL
);

-- TABLE: CUSTOMER
CREATE TABLE CUSTOMER (
    ID_CUSTOMER     CHAR(3) PRIMARY KEY,
    NM_CUSTOMER     VARCHAR(50) NOT NULL,
    ALMT_CUST       VARCHAR(100) NOT NULL,
    TELP_CUST       CHAR(12) NOT NULL
);

-- TABLE: USER
CREATE TABLE USER (
    ID_USER         CHAR(3) PRIMARY KEY,
    USERNAME        VARCHAR(10) NOT NULL,
    PASSWORD        VARCHAR(10) NOT NULL, -- typo diperbaiki dari PASSWROD
    ROLE            VARCHAR(20) NOT NULL
);

-- TABLE: TRANSAKSI
CREATE TABLE TRANSAKSI (
    ID_TRANS        CHAR(5) PRIMARY KEY,
    ID_CUSTOMER     CHAR(3) NOT NULL,
    ID_USER         CHAR(3) NOT NULL,
    TGL_TRANS       DATE NOT NULL,
    TOTAL_BAYAR     NUMERIC(7,0) NOT NULL,
    METODE_BAYAR    VARCHAR(10) NOT NULL,
    STATUS_TRANS    CHAR(6) NOT NULL
);

-- TABLE: DETAIL_TRANSAKSI
CREATE TABLE DETAIL_TRANSAKSI (
    ID_DETIL        CHAR(5) NOT NULL,
    ID_TRANS        CHAR(5) NOT NULL,
    ID_BRNG         CHAR(3) NOT NULL,
    JML_BELI        NUMERIC(3,0) NOT NULL,
    SUB_TOTAL       NUMERIC(7,0) NOT NULL,
    PRIMARY KEY (ID_TRANS, ID_BRNG, ID_DETIL)
);

-- FOREIGN KEYS
ALTER TABLE BARANG 
    ADD CONSTRAINT FK_DIMILIKI FOREIGN KEY (ID_KATEGORI)
    REFERENCES KATEGORI_BARANG (ID_KATEGORI)
    ON DELETE RESTRICT ON UPDATE RESTRICT;

ALTER TABLE BARANG 
    ADD CONSTRAINT FK_MEN_SUPPLY FOREIGN KEY (ID_SUPPLIER)
    REFERENCES SUPPLIER (ID_SUPPLIER)
    ON DELETE RESTRICT ON UPDATE RESTRICT;

ALTER TABLE DETAIL_TRANSAKSI 
    ADD CONSTRAINT FK_DETAIL_TRANSAKSI FOREIGN KEY (ID_TRANS)
    REFERENCES TRANSAKSI (ID_TRANS)
    ON DELETE RESTRICT ON UPDATE RESTRICT;

ALTER TABLE DETAIL_TRANSAKSI 
    ADD CONSTRAINT FK_DETAIL_TRANSAKSI2 FOREIGN KEY (ID_BRNG)
    REFERENCES BARANG (ID_BRNG)
    ON DELETE RESTRICT ON UPDATE RESTRICT;

ALTER TABLE TRANSAKSI 
    ADD CONSTRAINT FK_MELAKUKAN FOREIGN KEY (ID_CUSTOMER)
    REFERENCES CUSTOMER (ID_CUSTOMER)
    ON DELETE RESTRICT ON UPDATE RESTRICT;

ALTER TABLE TRANSAKSI 
    ADD CONSTRAINT FK_MENANGANI FOREIGN KEY (ID_USER)
    REFERENCES USER (ID_USER)
    ON DELETE RESTRICT ON UPDATE RESTRICT;
